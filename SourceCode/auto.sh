#!/bin/bash

make
printf "\n============================================================\n"

# Key < 32
sudo insmod ./cryptomodule.ko key="00010203040506070809"
sudo rmmod cryptomodule

# Key > 32
sudo insmod ./cryptomodule.ko key="000102030405060708090A0B0C0D0E0F10111213"
sudo rmmod cryptomodule

# Key == 32
sudo insmod ./cryptomodule.ko key="000102030405060708090A0B0C0D0E0F"
# The quick brown fox jumps over the lazy dog -- 43 Letters
# 54686520717569636b2062726f776e20666f78206a756d7073206f76657220746865206c617a7920646f67
# Pack my box with five dozen liquor jugs -- 39 Letters
# 5061636b206d7920626f782077697468206669766520646f7a656e206c6971756f72206a756773
# Still, Eddie gave the object another small squeeze. It didn't feel like a stone, exactly. But Callahan was probably right.  --  122 Letters
# 5374696c6c2c204564646965206761766520746865206f626a65637420616e6f7468657220736d616c6c2073717565657a652e204974206469646e2774206665656c206c696b6520612073746f6e652c2065786163746c792e204275742043616c6c6168616e207761732070726f6261626c792072696768742e
# Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam hendrerit lorem augue. In sollicitudin libero convallis leo accumsan tempus. Vestibulum posuere nisi scelerisque eleifend lobortis. Mauris felis lectus, dapibus ac.   --  229 Letters
# 4c6f72656d20697073756d20646f6c6f722073697420616d65742c20636f6e73656374657475722061646970697363696e6720656c69742e20416c697175616d2068656e647265726974206c6f72656d2061756775652e20496e20736f6c6c696369747564696e206c696265726f20636f6e76616c6c6973206c656f20616363756d73616e2074656d7075732e20566573746962756c756d20706f7375657265206e697369207363656c6572697371756520656c656966656e64206c6f626f727469732e204d61757269732066656c6973206c65637475732c20646170696275732061632e
# sudo ./test_cryptomodule "h 54686520717569636b2062726f776e20666f78206a756d7073206f76657220746865206c617a7920646f67"
# sudo ./test_cryptomodule "h 5061636b206d7920626f782077697468206669766520646f7a656e206c6971756f72206a756773"
# sudo ./test_cryptomodule "h 5374696c6c2c204564646965206761766520746865206f626a65637420616e6f7468657220736d616c6c2073717565657a652e204974206469646e2774206665656c206c696b6520612073746f6e652c2065786163746c792e204275742043616c6c6168616e207761732070726f6261626c792072696768742e"
# sudo ./test_cryptomodule "h 4c6f72656d20697073756d20646f6c6f722073697420616d65742c20636f6e73656374657475722061646970697363696e6720656c69742e20416c697175616d2068656e647265726974206c6f72656d2061756775652e20496e20736f6c6c696369747564696e206c696265726f20636f6e76616c6c6973206c656f20616363756d73616e2074656d7075732e20566573746962756c756d20706f7375657265206e697369207363656c6572697371756520656c656966656e64206c6f626f727469732e204d61757269732066656c6973206c65637475732c20646170696275732061632e"

sudo ./test_cryptomodule "h 5465737465313233"   ##  Teste123
sudo ./test_cryptomodule "c 5465737465313233"   ##  Teste123
sudo ./test_cryptomodule "d 4B4B909AE6FA1FC50809BC8260430757"

sudo rmmod cryptomodule
printf "\n============================================================\n"

# journalctl --since="10 seconds ago"| grep kernel
# dmesg | grep cryptomodule | tail
